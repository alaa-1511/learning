<div class="p-8 bg-white border-0 ring-1 ring-gray-100 rounded-2xl shadow-xl">
    
    <!-- Header & Actions -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row items-center justify-between mb-6 gap-4">
             <div class="text-center md:text-start">
                <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight mb-2">{{ 'MANAGE_QUESTIONS.TITLE' | translate }}</h1>
                <p class="text-base text-gray-500 font-medium">{{ 'MANAGE_QUESTIONS.SUBTITLE' | translate }}</p>
             </div>
             <button type="button" (click)="openNew()" class="text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 focus:ring-4 focus:ring-blue-300 font-semibold rounded-xl text-sm px-6 py-3 shadow-lg shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-0.5 flex items-center gap-2">
                <i class="pi pi-plus text-lg"></i> 
                <span>{{ 'MANAGE_QUESTIONS.ADD_NEW' | translate }}</span>
            </button>
        </div>

        <div class="flex flex-col lg:flex-row gap-4 items-center justify-between bg-gray-50/50 p-4 rounded-xl border border-dashed border-gray-200">
             <!-- Search -->
             <div class="relative w-full lg:w-96 group">
                <div class="absolute inset-y-0 start-0 flex items-center ps-4 pointer-events-none">
                    <svg class="w-4 h-4 text-gray-400 group-focus-within:text-blue-500 transition-colors" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                    </svg>
                </div>
                <input type="text" id="table-search" class="block w-full p-3 ps-11 text-sm text-gray-900 border-0 ring-1 ring-gray-200 rounded-full bg-white focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all shadow-sm" [placeholder]="'MANAGE_QUESTIONS.SEARCH_PLACEHOLDER' | translate" (input)="onSearch($event)">
            </div>

            <!-- Filters -->
             <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto">
                <div class="relative min-w-[200px]">
                    <select class="bg-white border-0 ring-1 ring-gray-200 text-gray-700 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 block w-full p-2.5 shadow-sm cursor-pointer transition-shadow" (change)="onPartFilter($event)">
                        <option [ngValue]="null">{{ 'MANAGE_QUESTIONS.ALL_PARTS' | translate }}</option>
                        <option *ngFor="let part of formParts" [value]="part.value">{{part.label}}</option>
                    </select>
                </div>
                
                <div class="relative min-w-[200px]">
                    <select class="bg-white border-0 ring-1 ring-gray-200 text-gray-700 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 block w-full p-2.5 shadow-sm cursor-pointer transition-shadow" (change)="onDifficultyFilter($event)">
                        <option [ngValue]="null">{{ 'MANAGE_QUESTIONS.ALL_DIFFICULTIES' | translate }}</option>
                        <option *ngFor="let diff of formDifficulties" [value]="diff.value">{{diff.label}}</option>
                    </select>
                </div>
             </div>
        </div>
    </div>

    <!-- Table -->
    <div class="relative overflow-hidden rounded-xl border border-gray-100 shadow-sm">
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left rtl:text-right text-gray-500">
                <thead class="text-xs text-gray-500 uppercase bg-gray-50/80 tracking-wider">
                    <tr>
                        <th scope="col" class="px-6 py-4 font-semibold">{{ 'MANAGE_QUESTIONS.TABLE.QUESTION' | translate }}</th>
                        <th scope="col" class="px-6 py-4 font-semibold">{{ 'MANAGE_QUESTIONS.TABLE.CIA_PART' | translate }}</th>
                        <th scope="col" class="px-6 py-4 font-semibold">{{ 'MANAGE_QUESTIONS.TABLE.TOPIC' | translate }}</th>
                        <th scope="col" class="px-6 py-4 font-semibold">{{ 'MANAGE_QUESTIONS.TABLE.DIFFICULTY' | translate }}</th>
                        <th scope="col" class="px-6 py-4 font-semibold">{{ 'MANAGE_QUESTIONS.TABLE.STATUS' | translate }}</th>
                        <th scope="col" class="px-6 py-4 font-semibold">{{ 'MANAGE_QUESTIONS.TABLE.ACTION' | translate }}</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    <tr *ngFor="let question of filteredQuestions | paginate: { itemsPerPage: 10, currentPage: p }" class="bg-white hover:bg-gray-50/80 transition-colors duration-150">
                        <th scope="row" class="px-6 py-4">
                            <div class="font-medium text-gray-900 max-w-xs truncate cursor-help" [title]="question.text">{{question.text}}</div>
                            <div class="mt-1 flex items-center gap-2 text-xs text-gray-500">
                                <span class="truncate max-w-[200px]">{{question.options[question.correctAnswer]}}</span>
                            </div>
                        </th>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-gray-100 text-gray-700 text-xs font-medium ring-1 ring-inset ring-gray-500/10">
                                {{question.ciaPart}}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <span class="text-gray-700 font-medium">{{question.topic}}</span>
                        </td>
                        <td class="px-6 py-4">
                            <span [ngClass]="{
                                'bg-emerald-50 text-emerald-700 ring-emerald-600/20': question.difficulty === 'Easy',
                                'bg-amber-50 text-amber-700 ring-amber-600/20': question.difficulty === 'Medium',
                                'bg-rose-50 text-rose-700 ring-rose-600/20': question.difficulty === 'Hard'
                            }" class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ring-1 ring-inset">
                                {{question.difficulty}}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                             <div class="flex items-center gap-1.5">
                                 <span class="w-2 h-2 rounded-full" [ngClass]="question.status === 'Active' ? 'bg-blue-500' : 'bg-gray-400'"></span>
                                 <span class="text-gray-700 text-sm">{{question.status}}</span>
                             </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-3">
                                <button (click)="editQuestion(question)" class="p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" [title]="'MANAGE_QUESTIONS.EDIT' | translate">
                                    <i class="pi pi-pencil"></i>
                                </button>
                                <button (click)="deleteQuestion(question)" class="p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors" [title]="'MANAGE_QUESTIONS.DELETE' | translate">
                                    <i class="pi pi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <div class="p-4 border-t border-gray-100 bg-gray-50/30 flex justify-center">
             <pagination-controls (pageChange)="p = $event" class="custom-pagination"></pagination-controls>
        </div>
    </div>
</div>

<!-- Main Modal (Add/Edit) -->
<div *ngIf="questionDialog" tabindex="-1" aria-hidden="true" class="overflow-y-auto overflow-x-hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/60 backdrop-blur-sm transition-opacity">
    <div class="relative w-full max-w-2xl bg-white rounded-2xl shadow-2xl transform transition-all scale-100">
        <!-- Modal content -->
        <div class="relative">
            <!-- Modal header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-100">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-blue-50 rounded-lg text-blue-600">
                         <i class="pi" [ngClass]="isEditMode ? 'pi-file-edit' : 'pi-plus-circle'" style="font-size: 1.5rem"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">
                        {{ isEditMode ? ('MANAGE_QUESTIONS.MODAL.EDIT_TITLE' | translate) : ('MANAGE_QUESTIONS.MODAL.ADD_TITLE' | translate) }}
                    </h3>
                </div>
                <button type="button" (click)="hideDialog()" class="text-gray-400 bg-transparent hover:bg-gray-100 hover:text-gray-900 rounded-xl text-sm w-9 h-9 ms-auto inline-flex justify-center items-center transition-colors">
                    <i class="pi pi-times"></i>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <div class="p-6 space-y-6 max-h-[70vh] overflow-y-auto custom-scrollbar">
                <form [formGroup]="questionForm">
                     <!-- Question Text -->
                    <div class="mb-6">
                        <label for="text" class="block mb-2 text-sm font-semibold text-gray-900">{{ 'MANAGE_QUESTIONS.MODAL.QUESTION_TEXT' | translate }}</label>
                        <textarea id="text" formControlName="text" rows="3" class="block p-3 w-full text-gray-700 bg-gray-50/50 rounded-xl border-0 ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all resize-y" [placeholder]="'MANAGE_QUESTIONS.MODAL.ENTER_QUESTION' | translate"></textarea>
                         <p *ngIf="submitted && questionForm.get('text')?.invalid" class="mt-2 text-sm text-red-600 flex items-center gap-1">
                            <i class="pi pi-exclamation-circle"></i>
                            {{ 'MANAGE_QUESTIONS.MODAL.QUESTION_REQUIRED' | translate }}
                        </p>
                    </div>

                    <!-- Grid for Meta Data -->
                    <div class="grid gap-6 mb-6 md:grid-cols-2">
                        <div>
                            <label class="block mb-2 text-sm font-semibold text-gray-900">{{ 'MANAGE_QUESTIONS.MODAL.CIA_PART' | translate }}</label>
                            <select formControlName="ciaPart" class="bg-gray-50/50 border-0 ring-1 ring-gray-200 text-gray-700 text-sm rounded-xl focus:ring-blue-500 block w-full p-3 transition-shadow">
                                <option *ngFor="let part of formParts" [value]="part.value">{{part.label}}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-semibold text-gray-900">{{ 'MANAGE_QUESTIONS.MODAL.TOPIC' | translate }}</label>
                            <input type="text" formControlName="topic" class="bg-gray-50/50 border-0 ring-1 ring-gray-200 text-gray-700 text-sm rounded-xl focus:ring-blue-500 block w-full p-3 transition-shadow" [placeholder]="'MANAGE_QUESTIONS.MODAL.TOPIC_PLACEHOLDER' | translate" required />
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-semibold text-gray-900">{{ 'MANAGE_QUESTIONS.MODAL.DIFFICULTY' | translate }}</label>
                             <select formControlName="difficulty" class="bg-gray-50/50 border-0 ring-1 ring-gray-200 text-gray-700 text-sm rounded-xl focus:ring-blue-500 block w-full p-3 transition-shadow">
                                <option *ngFor="let diff of formDifficulties" [value]="diff.value">{{diff.label}}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-semibold text-gray-900">{{ 'MANAGE_QUESTIONS.MODAL.STATUS' | translate }}</label>
                             <select formControlName="status" class="bg-gray-50/50 border-0 ring-1 ring-gray-200 text-gray-700 text-sm rounded-xl focus:ring-blue-500 block w-full p-3 transition-shadow">
                                <option *ngFor="let status of formStatuses" [value]="status.value">{{status.label}}</option>
                            </select>
                        </div>
                    </div>

                    <!-- Answers -->
                    <div class="mb-2">
                         <div class="flex items-center justify-between mb-3">
                             <label class="text-sm font-semibold text-gray-900">{{ 'MANAGE_QUESTIONS.MODAL.ANSWER_OPTIONS' | translate }}</label>
                             <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">Select the correct answer</span>
                         </div>
                         
                         <div formArrayName="options" class="space-y-3">
                            <div *ngFor="let opt of optionsControls.controls; let i=index" class="group flex items-center ps-4 border border-gray-200 rounded-xl bg-gray-50/30 hover:bg-gray-50 transition-colors focus-within:ring-2 focus-within:ring-blue-500/50 focus-within:border-blue-500">
                                <div class="relative flex items-center">
                                    <input [id]="'radio-'+i" type="radio" [value]="i" formControlName="correctAnswer" name="correctAnswer" class="w-5 h-5 text-blue-600 bg-white border-gray-300 focus:ring-blue-500 focus:ring-2 cursor-pointer">
                                </div>
                                <input [formControlName]="i" type="text" class="w-full border-none bg-transparent focus:ring-0 text-sm p-4 text-gray-700 placeholder-gray-400" [placeholder]="'MANAGE_QUESTIONS.MODAL.OPTION_PLACEHOLDER' | translate:{index: i+1}">
                                <button *ngIf="optionsControls.length > 2" (click)="removeOption(i)" type="button" class="text-gray-400 hover:text-red-500 p-3 me-1 opacity-0 group-hover:opacity-100 transition-opacity" title="Remove option">
                                    <i class="pi pi-trash"></i>
                                </button>
                            </div>
                         </div>
                         <button type="button" (click)="addOption()" class="mt-4 w-full py-2.5 border-2 border-dashed border-gray-300 rounded-xl text-sm font-medium text-gray-500 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50/50 transition-all flex items-center justify-center gap-2">
                             <i class="pi pi-plus"></i>
                             {{ 'MANAGE_QUESTIONS.MODAL.ADD_OPTION' | translate }}
                         </button>
                    </div>

                </form>
            </div>
            <!-- Modal footer -->
            <div class="flex items-center justify-end gap-3 p-6 border-t border-gray-100 bg-gray-50/50 rounded-b-2xl">
                <button (click)="hideDialog()" type="button" class="px-5 py-2.5 text-sm font-semibold text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:text-gray-900 focus:z-10 focus:ring-4 focus:ring-gray-100 transition-colors">
                    {{ 'MANAGE_QUESTIONS.MODAL.CANCEL' | translate }}
                </button>
                <button (click)="saveQuestion()" type="button" class="px-5 py-2.5 text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 rounded-lg shadow-lg shadow-blue-500/30 transition-all">
                    {{ 'MANAGE_QUESTIONS.MODAL.SAVE' | translate }}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal (Premium) -->
<div *ngIf="deleteDialog" tabindex="-1" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/60 backdrop-blur-sm transition-opacity">
    <div class="relative w-full max-w-sm bg-white rounded-2xl shadow-2xl transform transition-all">
        <div class="p-6 text-center">
            <div class="w-16 h-16 mx-auto mb-4 bg-red-50 rounded-full flex items-center justify-center text-red-500">
                <i class="pi pi-exclamation-triangle text-2xl"></i>
            </div>
            <h3 class="mb-2 text-xl font-bold text-gray-900">{{ 'MANAGE_QUESTIONS.MODAL.DELETE_TITLE' | translate }}</h3>
            <p class="text-gray-500 mb-8 font-medium">Are you sure you want to delete this question? This action cannot be undone.</p>
            
            <div class="flex items-center justify-center gap-3">
                <button (click)="deleteDialog = false" type="button" class="px-5 py-2.5 text-sm font-semibold text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 focus:ring-4 focus:ring-gray-100 transition-colors">
                    {{ 'MANAGE_QUESTIONS.MODAL.CANCEL_DELETE' | translate }}
                </button>
                <button (click)="confirmDelete()" type="button" class="px-5 py-2.5 text-sm font-semibold text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 rounded-lg shadow-lg shadow-red-500/30 transition-all">
                    {{ 'MANAGE_QUESTIONS.MODAL.CONFIRM_DELETE' | translate }}
                </button>
            </div>
        </div>
    </div>
</div>
